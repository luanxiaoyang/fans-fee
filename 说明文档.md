# 直播成本计算系统 - 项目说明文档

## 项目概述

本项目是一个基于Node.js + Express的直播成本计算系统，提供Web界面进行成本计算和报告生成。

## 项目规划

### 技术栈
- **后端**: Node.js + Express.js
- **前端**: HTML5 + CSS3 + JavaScript
- **部署**: Docker + Docker Compose
- **端口**: 34145

### 功能模块
1. 成本计算API
2. Web界面展示
3. 日报生成功能
4. 健康检查接口

## 实施方案

### 端口配置修改
- ✅ **已完成** - 将默认端口从8000修改为34145
- ✅ **已完成** - 更新app.js中的PORT配置
- ✅ **已完成** - 更新start.bat中的访问地址提示
- ✅ **已完成** - 更新README.md中的端口信息

### Docker部署配置
- ✅ **已完成** - 创建Dockerfile，基于node:18-alpine镜像
- ✅ **已完成** - 创建docker-compose.yml，配置服务和网络
- ✅ **已完成** - 创建.dockerignore，优化构建过程
- ✅ **已完成** - 创建deploy.bat部署脚本
- ✅ **已完成** - 更新README.md，添加Docker部署说明

### 部署方式
1. **传统部署**: 使用start.bat或npm start
2. **Docker部署**: 使用deploy.bat或docker-compose命令
3. **生产环境**: 推荐使用Docker部署

## 进度记录

### 2024年当前进度
- ✅ **已完成** (当前时间) - 端口修改为34145
- ✅ **已完成** (当前时间) - Docker配置文件创建
- ✅ **已完成** (当前时间) - Nginx反向代理集成
- ✅ **已完成** (当前时间) - Linux部署脚本创建
- ✅ **已完成** (当前时间) - 部署脚本创建
- ✅ **已完成** (当前时间) - 文档更新
- ⚠️ **网络问题** (当前时间) - Docker镜像拉取失败，已提供解决方案
- ✅ **已完成** (当前时间) - 创建网络问题修复脚本
- ✅ **验证通过** (当前时间) - Node.js本地部署正常运行在34145端口

## 部署说明

### Docker + Nginx部署（生产推荐）

1. **前置要求**
   - 安装Docker和Docker Compose
   - 确保端口80和443可用

2. **Linux服务器部署**
   ```bash
   # 赋予执行权限
   chmod +x deploy.sh
   
   # 完整部署
   ./deploy.sh deploy
   
   # 其他操作
   ./deploy.sh start|stop|restart|status|logs
   ```

3. **Windows开发环境**
   ```bash
   # 使用部署脚本
   deploy.bat
   
   # 或手动执行
   docker-compose up -d
   ```

4. **访问应用**
   - **生产访问**: http://localhost （通过Nginx）
   - **开发调试**: http://localhost:34145 （直接访问Node.js）
   - **健康检查**: http://localhost/health

### 传统部署

1. **安装依赖**
   ```bash
   npm install
   ```

2. **启动服务**
   ```bash
   npm start
   # 或使用
   start.bat
   ```

### 开发模式

```bash
# 开发环境启动
npm run dev
```

### 服务架构

```
生产环境:
用户 → Nginx (端口80/443) → Node.js应用 (端口34145)

开发环境:
用户 → Node.js应用 (端口34145)
```

### 常用Docker命令
```bash
# 启动服务
docker-compose up -d

# 查看状态
docker-compose ps

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down

# 重新构建
docker-compose build --no-cache
```

### 文件结构
```
fans-fee/
├── app.js                    # 主应用文件
├── package.json             # 项目配置
├── Dockerfile              # Node.js应用Docker配置
├── Dockerfile.nginx        # Nginx Docker配置
├── nginx.conf              # Nginx反向代理配置
├── docker-compose.yml      # Docker编排配置(含Nginx)
├── .dockerignore           # Docker忽略文件
├── deploy.bat              # Windows部署脚本
├── deploy.sh               # Linux部署脚本
├── docker-fix-network.bat  # Docker网络问题修复脚本
├── start.bat               # 传统启动脚本
├── README.md               # 项目说明
├── Docker部署说明.md       # Docker详细部署文档
├── 说明文档.md             # 本文档
├── logs/                   # 日志目录
│   └── nginx/              # Nginx日志目录
├── ssl/                    # SSL证书目录(可选)
└── static/                 # 静态文件目录
    └── index.html          # 前端页面
```

## 注意事项

1. **端口冲突**: 确保34145端口未被其他应用占用
2. **Docker环境**: 确保Docker服务正常运行
3. **防火墙**: 如需外部访问，请开放34145端口
4. **日志监控**: 生产环境建议配置日志收集和监控

## 后续优化建议

1. ✅ ~~考虑使用Nginx作为反向代理~~ (已完成)
2. 添加环境变量配置文件(.env)
3. ✅ ~~配置生产环境的日志管理~~ (已配置基础日志)
4. ✅ ~~添加健康检查和监控~~ (已添加健康检查)
5. 配置SSL证书支持HTTPS (配置文件已准备，需要证书文件)
6. 添加负载均衡支持(多实例部署)
7. 配置监控告警系统
8. 添加自动化CI/CD流程